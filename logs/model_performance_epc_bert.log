[Logging] Tee output to logs\model_performance_epc_bert.log
======================================================================
Prediction Modeling for Ad Optimization (No IAI)
======================================================================
Target: epc
Models: ridge, xgb, rf
Embedding method: bert
======================================================================
Loading data from data/clean...
  Train: 14100 rows, Test: 4701 rows

Features (66): Match type, Region, day_of_week, is_weekend, month...
Train shape: (14100, 66), Test shape: (4701, 66)

--- Ridge Regression (MSE) ---
c:\Users\jsitu\anaconda3\lib\site-packages\sklearn\linear_model\_ridge.py:215: LinAlgWarning: Ill-conditioned matrix (rcond=3.80801e-18): result may not be accurate.
  return linalg.solve(A, Xy, assume_a="pos", overwrite_a=True).T
  [GLM] Best CV MSE (weighted): 45009.338947
  Best params: {'model__alpha': 5.0}
  Train MSE (lower is better): 44432.5236
  Test  MSE (lower is better): 38239.6542
  [Ridge train] mean(y)=25.1211 mean(pred)=23.6329 bias=-1.4882 | wmean(y)=19.3144 wmean(pred)=19.3144 wbias=0.0000
  [Ridge train] quantiles y: min=0 p1=0 med=0 p99=212.8 max=1.628e+04
  [Ridge train] quantiles pred: min=-110.9 p1=-40.58 med=17.67 p99=158.1 max=554.4
  [Ridge test] mean(y)=22.7055 mean(pred)=23.6785 bias=0.9730 | wmean(y)=14.8010 wmean(pred)=18.7974 wbias=3.9964
  [Ridge test] quantiles y: min=0 p1=0 med=0 p99=200 max=1.366e+04
  [Ridge test] quantiles pred: min=-298.8 p1=-43.22 med=17.59 p99=155.2 max=545.9
  Saved pipeline to models\ridge_bert_epc.joblib
  Saved preprocessor to models\ridge_bert_epc_preprocess.joblib
  Exported weights: weights_bert_epc_numeric.csv, weights_bert_epc_constant.csv, weights_bert_epc_categorical.csv
  [Ridge] Global bias: 3.9964
  [Ridge] Top decile lift: 4.8658
  [Ridge] Conditional MAE: 57.3314
  [Ridge] R^2: 0.0093

--- XGBoost (MSE) ---
  [XGB] Best CV MSE (weighted): 44762.755535
  Best params: {'model__colsample_bytree': 1.0, 'model__learning_rate': 0.3, 'model__max_depth': 2, 'model__n_estimators': 10, 'model__subsample': 1.0}
  Train MSE (lower is better): 41813.3739
  Test  MSE (lower is better): 38831.3555
  [XGB train] mean(y)=25.1211 mean(pred)=23.6634 bias=-1.4576 | wmean(y)=19.3144 wmean(pred)=19.3006 wbias=-0.0138
  [XGB train] quantiles y: min=0 p1=0 med=0 p99=212.8 max=1.628e+04
  [XGB train] quantiles pred: min=7.238 p1=7.238 med=14.28 p99=295.6 max=2956
  [XGB test] mean(y)=22.7055 mean(pred)=22.7106 bias=0.0051 | wmean(y)=14.8010 wmean(pred)=19.0887 wbias=4.2876
  [XGB test] quantiles y: min=0 p1=0 med=0 p99=200 max=1.366e+04
  [XGB test] quantiles pred: min=7.238 p1=7.238 med=14.28 p99=259.8 max=1216
  Saved model to models\xgb_mse_bert_epc.json
  Saved preprocessor to models\xgb_mse_bert_epc_preprocess.joblib
  [XGB] Global bias: 4.2876
  [XGB] Top decile lift: 4.5323
  [XGB] Conditional MAE: 56.4889
  [XGB] R^2: -0.0060

--- XGBoost RF (MSE) ---
  [RF] Best CV MSE (weighted): 45508.829643
  Best params: {'model__colsample_bynode': 0.9, 'model__max_depth': 4, 'model__n_estimators': 5, 'model__subsample': 0.9}
  Train MSE (lower is better): 45337.5368
  Test  MSE (lower is better): 38611.0232
  [RF train] mean(y)=25.1211 mean(pred)=19.3519 bias=-5.7691 | wmean(y)=19.3144 wmean(pred)=19.3118 wbias=-0.0026
  [RF train] quantiles y: min=0 p1=0 med=0 p99=212.8 max=1.628e+04
  [RF train] quantiles pred: min=19.21 p1=19.21 med=19.27 p99=21.41 max=69.04
  [RF test] mean(y)=22.7055 mean(pred)=19.3412 bias=-3.3643 | wmean(y)=14.8010 wmean(pred)=19.3107 wbias=4.5096
  [RF test] quantiles y: min=0 p1=0 med=0 p99=200 max=1.366e+04
  [RF test] quantiles pred: min=19.19 p1=19.21 med=19.27 p99=21.41 max=51.77
  Saved model to models\rf_mse_bert_epc.json
  [RF] Global bias: 4.5096
  [RF] Top decile lift: 3.2565
  [RF] Conditional MAE: 59.1980
  [RF] R^2: -0.0003

======================================================================
Model Performance Summary (Test MSE - lower is better)
======================================================================

Target Statistics (for context):
  Mean: 22.7055
  Std Dev: 345.0462
  Variance (baseline MSE): 119056.8750
  Median: 0.0000
  Min: 0.0000
  Max: 13661.7000

  Ridge : MSE=38239.6542 | R^2=0.0093 | bias=3.9964 | top-decile lift=4.8658 | cMAE=57.3314
  RF    : MSE=38611.0232 | R^2=-0.0003 | bias=4.5096 | top-decile lift=3.2565 | cMAE=59.1980
  XGB   : MSE=38831.3555 | R^2=-0.0060 | bias=4.2876 | top-decile lift=4.5323 | cMAE=56.4889

Best model: Ridge
======================================================================
