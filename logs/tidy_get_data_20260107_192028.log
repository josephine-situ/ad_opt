[Log] Writing output to logs\tidy_get_data_20260107_192028.log
======================================================================
Data Preparation Pipeline for Ad Optimization
======================================================================
Embedding method: bert
N components: 50
Force reload: True
======================================================================

[Step 1] Load and combine keyword data...
  [Computing] Running load_and_combine_keyword_data...
[Step 1] Loading and combining keyword data...
  Using combined raw report: Search keyword - raw input to models.csv
  Data covers: 2024-07-05 00:00:00 to 2026-01-07 00:00:00
  Total rows: 59466
  [Saved] Cached to step1_combined.parquet

[Step 2] Format keyword data...
[Step 2] Formatting keyword data...

[Step 3] Extract date features...
  [Computing] Running extract_date_features...
[Step 3] Extracting date features...
  [Saved] Cached to step3_features.parquet

[Step 4] Filter data by date...
  [Computing] Running filter_data_by_date...
[Step 4] Filtering data from 2024-11-03 onwards...
  Rows after filter: 40329
  [Saved] Cached to step4_filtered.parquet

[Step 5] Load GKP data...
[Step 5] Loading Google Keyword Planner data...
  Found GKP file: Saved Keywords Stats 2026-01-07 at 18_01_42.csv
  Loaded 4498 rows from Saved Keywords Stats 2026-01-07 at 18_01_42.csv
  After cleaning: 4496 rows with unique keywords

[Step 5.5] Impute missing data...
[Step 5.5] Imputing missing data...
  Total: Imputed 0 missing values (0.00% of total data)
  Imputed missing values by keyword Origin:
    existing                    0 (  0.00%)
[Step 5.5] Imputing missing data...
c:\Users\jsitu\OneDrive\Documents\Courses\Research\ad_opt\utils\data_pipeline.py:383: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  df[col].fillna(0, inplace=True)
c:\Users\jsitu\OneDrive\Documents\Courses\Research\ad_opt\utils\data_pipeline.py:386: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  df[col].fillna('Missing', inplace=True)

  Imputation Summary:
  -------------------------------------------------------------------------------------
  searches_2024_07                        10.90% numeric (0)               (n=490)
  searches_2024_08                        10.90% numeric (0)               (n=490)
  searches_2024_09                        10.90% numeric (0)               (n=490)
  searches_2024_10                        10.90% numeric (0)               (n=490)
  searches_2024_11                        10.90% numeric (0)               (n=490)
  searches_2024_12                        10.90% numeric (0)               (n=490)
  searches_2025_01                        10.90% numeric (0)               (n=490)
  searches_2025_02                        10.90% numeric (0)               (n=490)
  searches_2025_03                        10.90% numeric (0)               (n=490)
  searches_2025_04                        10.90% numeric (0)               (n=490)
  searches_2025_05                        10.90% numeric (0)               (n=490)
  searches_2025_06                        10.90% numeric (0)               (n=490)
  searches_2025_07                        10.90% numeric (0)               (n=490)
  searches_2025_08                        10.90% numeric (0)               (n=490)
  searches_2025_09                        10.90% numeric (0)               (n=490)
  searches_2025_10                        10.90% numeric (0)               (n=490)
  searches_2025_11                        10.90% numeric (0)               (n=490)
  Competition                             22.64% categorical (Missing)     (n=1018)
  Competition (indexed value)             22.64% numeric (0)               (n=1018)
  Top of page bid (low range)             41.73% numeric (0)               (n=1876)
  Top of page bid (high range)            41.73% numeric (0)               (n=1876)
  -------------------------------------------------------------------------------------
  Total: Imputed 14118 missing values (14.27% of total data)
  Imputed missing values by keyword Origin:
    new                     10056 ( 71.23%)
    existing searches        3805 ( 26.95%)
    existing                  257 (  1.82%)

[Step 6] Merge with GKP data...
  [Computing] Running merge_with_ads_data...
[Step 6] Merging with GKP data by keyword and date...
  Found 17 monthly search columns
  Fuzzy-matched 5238 rows using similar-word normalization
  Fuzzy mappings (16):
    ai certificate programs -> ai certification programs
    ai certification courses -> ai certificate course
    ai courses for executives -> ai course for executives
    ai courses near me -> ai course near me
    ai for business -> ai for businesses
    ai for engineers -> ai for engineering
    artificial intelligence certification mit -> ai certification mit
    artificial intelligence course -> artificial intelligence courses
    artificial intelligence for engineering -> ai for engineering
    artificial intelligence for engineers -> ai for engineering
    best ai courses -> best ai course
    harvard ai course -> harvard ai courses
    mit ai certificate -> mit ai certifications
    mit ai class -> mit ai classes
    mit ai program -> mit ai programs
    mit artificial intelligence course -> mit ai courses
  Calculating time series statistics...
  Added time series statistics columns
  Matched 149 unique keywords from GKP
  Unmatched 7 keywords (no GKP data): ['ai learning course', 'courses on artificial intelligence', 'best course for artificial intelligence', 'diploma in artificial intelligence', 'stanford ai course']...
  Calculated EPC (Expected Conversion value Per Click)

  NaN check after time series calculations:
    last_month_searches         1737 rows (  4.31%)
    three_month_avg             1737 rows (  4.31%)
    six_month_avg               1737 rows (  4.31%)
    mom_change                  1737 rows (  4.31%)
    search_trend                1737 rows (  4.31%)
  Merged rows: 40329
  [Saved] Cached to step6_merged.parquet

[Step 7] Add BERT embeddings...
  [Computing] Running add_embeddings...
[Step 8] Computing BERT embeddings...
  Processing 156 unique keywords...
C:\Users\jsitu\anaconda3\lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\jsitu\anaconda3\lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\jsitu\anaconda3\lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\jsitu\anaconda3\lib\site-packages\huggingface_hub\file_download.py:945: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
C:\Users\jsitu\anaconda3\lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
Batches:   0%|                                                                                                                         | 0/5 [00:00<?, ?it/s]Batches:  20%|######################6                                                                                          | 1/5 [00:01<00:07,  1.95s/it]Batches:  60%|###################################################################8                                             | 3/5 [00:02<00:01,  1.81it/s]Batches: 100%|#################################################################################################################| 5/5 [00:02<00:00,  2.30it/s]
  Saved BERT pipeline to data\clean\bert_pipeline_50d.pkl
  Embeddings added with shape: 156 x 51
  [Saved] Cached to step8_embeddings_bert.parquet

[Step 8] Removing rows with NaN values...
  Data after NaN removal: 38592 rows

[Step 9] Preparing train-test split and saving outputs...
[Step 9] Preparing train-test split...
  Train set: 28944 rows
  Test set: 9648 rows
[Step 10] Saving outputs to data/clean/...
  Saved: data\clean\ad_opt_data_bert.csv
  Saved: data\clean\train_bert.csv
  Saved: data\clean\test_bert.csv
  Saved: data\clean\unique_keyword_embeddings_bert.csv (149 rows)
======================================================================
âœ“ Pipeline completed successfully!
======================================================================
