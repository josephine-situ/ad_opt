======================================================================
Prediction Modeling for Ad Optimization (No IAI)
======================================================================
Target: clicks
Models: glm, xgb, rf, tabpfn
Embedding method: bert
======================================================================
Loading data from data/clean...
  Train: 12063 rows, Test: 4022 rows

Features (66): Match type, Region, day_of_week, is_weekend, month...
Train shape: (12063, 66), Test shape: (4022, 66)

--- Linear Regression (MSE) ---
  Best params: {'model__alpha': 5.0}
  Train MSE (lower is better): 91.0471
  Test  MSE (lower is better): 112.1336
  [GLM train] mean(y)=4.1233 mean(pred)=4.1233 bias=0.0000
  [GLM train] quantiles y: min=1 p1=1 med=2 p99=40 max=333
  [GLM train] quantiles pred: min=-4.114 p1=-2.334 med=2.693 p99=27.19 max=31.06
  [GLM test] mean(y)=4.4368 mean(pred)=4.1992 bias=-0.2376
  [GLM test] quantiles y: min=1 p1=1 med=2 p99=54 max=235
  [GLM test] quantiles pred: min=-3.972 p1=-1.975 med=2.745 p99=27.12 max=30.94
  Saved pipeline to models\glm_bert_clicks.joblib
  Exported weights: weights_bert_clicks_numeric.csv, weights_bert_clicks_constant.csv, weights_bert_clicks_categorical.csv
  [GLM] Global bias: -0.2376
  [GLM] Top decile lift: 4.2122
  [GLM] Conditional MAE: 3.9608
  [GLM] R^2: 0.2342

--- XGBoost (MSE) ---
  Best params: {'model__colsample_bytree': 1.0, 'model__learning_rate': 0.3, 'model__max_depth': 4, 'model__n_estimators': 20, 'model__subsample': 1.0}
  Train MSE (lower is better): 22.9038
  Test  MSE (lower is better): 35.8853
  [XGB train] mean(y)=4.1233 mean(pred)=4.1237 bias=0.0004
  [XGB train] quantiles y: min=1 p1=1 med=2 p99=40 max=333
  [XGB train] quantiles pred: min=-2.028 p1=0.5362 med=2.28 p99=32.42 max=194.6
  [XGB test] mean(y)=4.4368 mean(pred)=4.5083 bias=0.0714
  [XGB test] quantiles y: min=1 p1=1 med=2 p99=54 max=235
  [XGB test] quantiles pred: min=-9.081 p1=0.5408 med=2.28 p99=34.17 max=187.7
  Saved model to models\xgb_mse_bert_clicks.json
  Saved preprocessor to models\xgb_mse_bert_clicks_preprocess.joblib
  [XGB] Global bias: 0.0714
  [XGB] Top decile lift: 5.0465
  [XGB] Conditional MAE: 2.3342
  [XGB] R^2: 0.7549

--- XGBoost RF (MSE) ---
  Best params: {'model__colsample_bynode': 0.9, 'model__max_depth': 4, 'model__n_estimators': 5, 'model__subsample': 0.9}
  Train MSE (lower is better): 116.3784
  Test  MSE (lower is better): 144.4671
  [RF train] mean(y)=4.1233 mean(pred)=4.1229 bias=-0.0004
  [RF train] quantiles y: min=1 p1=1 med=2 p99=40 max=333
  [RF train] quantiles pred: min=4.094 p1=4.094 med=4.099 p99=4.376 max=5.726
  [RF test] mean(y)=4.4368 mean(pred)=4.1260 bias=-0.3108
  [RF test] quantiles y: min=1 p1=1 med=2 p99=54 max=235
  [RF test] quantiles pred: min=4.094 p1=4.094 med=4.099 p99=4.373 max=5.726
  Saved model to models\rf_mse_bert_clicks.json
  [RF] Global bias: -0.3108
  [RF] Top decile lift: 4.4118
  [RF] Conditional MAE: 4.2836
  [RF] R^2: 0.0134

--- TabPFN ---
  [TabPFN] Subsampled train rows: 12063 -> 10000
  Train MSE (lower is better): 29.0544
  Test  MSE (lower is better): 36.8745
  [TabPFN train] mean(y)=4.1233 mean(pred)=3.6908 bias=-0.4324
  [TabPFN train] quantiles y: min=1 p1=1 med=2 p99=40 max=333
  [TabPFN train] quantiles pred: min=1.005 p1=1.033 med=1.648 p99=29.15 max=113.8
  [TabPFN test] mean(y)=4.4368 mean(pred)=3.9797 bias=-0.4572
  [TabPFN test] quantiles y: min=1 p1=1 med=2 p99=54 max=235
  [TabPFN test] quantiles pred: min=1.008 p1=1.035 med=1.636 p99=30.74 max=113.4
  Saved pipeline to models\tabpfn_bert_clicks.joblib
  [TabPFN] Global bias: -0.4572
  [TabPFN] Top decile lift: 5.3588
  [TabPFN] Conditional MAE: 1.8777
  [TabPFN] R^2: 0.7482

======================================================================
Model Performance Summary (Test MSE - lower is better)
======================================================================

Target Statistics (for context):
  Mean: 4.4368
  Std Dev: 12.1023
  Variance (baseline MSE): 146.4654
  Median: 2.0000
  Min: 1.0000
  Max: 235.0000

  XGB   : MSE=35.8853 | R^2=0.7549 | bias=0.0714 | top-decile lift=5.0465 | cMAE=2.3342
  TabPFN: MSE=36.8745 | R^2=0.7482 | bias=-0.4572 | top-decile lift=5.3588 | cMAE=1.8777
  GLM   : MSE=112.1336 | R^2=0.2342 | bias=-0.2376 | top-decile lift=4.2122 | cMAE=3.9608
  RF    : MSE=144.4671 | R^2=0.0134 | bias=-0.3108 | top-decile lift=4.4118 | cMAE=4.2836

Best model: XGB
======================================================================
